<div class="chat-input-container">
    <textarea @bind="messageText"
              @oninput="AutoGrow"
              @onkeydown="HandleKeyDown"
              rows="1"
              placeholder="Type your message here..."></textarea>
    <button class="icon-btn attach-btn">
        <i class="bi bi-paperclip"></i>
    </button>
    <button class="send-btn" @onclick="SendMessage">
        <span>Send</span>
        <i class="bi bi-send"></i>
    </button>
</div>

@code {
    [Parameter]
    public EventCallback<string> OnSendMessage { get; set; }

    private string messageText = "";

    [Inject]
    public IJSRuntime JSRuntime { get; set; }

    private async Task SendMessage()
    {
        await OnSendMessage.InvokeAsync(messageText);
        messageText = "";
        // Reset textarea height after sending
        await JSRuntime.InvokeVoidAsync("resetTextareaHeight");
    }

    private async Task HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" && !e.ShiftKey)
        {
            // e.preventDefault(); // Prevent new line
            await SendMessage();
        }
    }

    private async void AutoGrow(ChangeEventArgs e)
    {
        await JSRuntime.InvokeVoidAsync("autoGrowTextarea", e.Value);
    }
}