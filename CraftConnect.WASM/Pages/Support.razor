@page "/support"
@layout SupportLayout
@using CraftConnect.WASM.Layout
@using CraftConnect.WASM.Components.SupportPageComponents
@using CraftConnect.WASM.ViewModels

<div class="support-page-container">

    <!-- Hero Section -->
    <header class="hero-section">
        <h1>Help Center</h1>
        <p>We're here to help you with any questions you may have.</p>
    </header>

    <!-- Main Content Area -->
    <div class="main-content-area">
        <!-- Left Column: Search, Tabs, FAQs -->
        <div class="faq-column">

            <!-- Search Bar -->
            <div class="search-card">
                <i class="bi bi-search search-icon"></i>
                <input type="text" class="search-input" placeholder="How can we help you today?"
                       @bind="searchTerm" @bind:event="oninput" />
            </div>

            <!-- FAQ Tabs -->
            <div class="faq-tabs">
                @foreach (var category in categories)
                {
                    <button class="tab-btn @(category == activeCategory ? "active" : "")"
                            @onclick="() => activeCategory = category">
                        @category
                    </button>
                }
            </div>

            <!-- FAQ List -->
            <div class="faq-list">
                @if (FilteredFaqs.Any())
                {
                    @foreach (var item in FilteredFaqs)
                    {
                        <FaqAccordion Item="item" />
                    }
                }
                else
                {
                    <p class="no-results">No articles found matching your search.</p>
                }
            </div>
        </div>

        <!-- Right Column: Sidebar -->
        <aside class="sidebar-column">
            <StillNeedHelp />
            <SendEmailForm />
        </aside>
    </div>
</div>

@code {
    private string searchTerm = "";
    private string activeCategory = "Getting Started";

    private List<string> categories = new()
    {
        "Getting Started", "Account & Profile", "Payments & Billing", "Project Management", "Trust & Safety"
    };

    private List<FaqItem> allFaqs = new();

    private IEnumerable<FaqItem> FilteredFaqs => allFaqs
        .Where(f => f.Category == activeCategory)
        .Where(f => string.IsNullOrWhiteSpace(searchTerm) ||
                    f.Question.Contains(searchTerm, StringComparison.OrdinalIgnoreCase) ||
                    f.Answer.Contains(searchTerm, StringComparison.OrdinalIgnoreCase));

    protected override void OnInitialized()
    {
        // Mock data initialization (Same as before)
        allFaqs = new List<FaqItem> {
            new FaqItem { Id = Guid.NewGuid(), Category = "Getting Started", Question = "How do I create an account?", Answer = "To create an account..." },
            new FaqItem { Id = Guid.NewGuid(), Category = "Getting Started", Question = "How do I find a craftsman?", Answer = "You can find a craftsman by..." },
            new FaqItem { Id = Guid.NewGuid(), Category = "Payments & Billing", Question = "How are payments handled?", Answer = "Payments are handled securely..." }
            // Add more items...
        };
    }
}