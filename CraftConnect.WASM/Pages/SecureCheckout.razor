@page "/checkout"
@layout CheckoutLayout
@using CraftConnect.WASM.Layout
@using CraftConnect.WASM.Components.SecureCheckoutPageComponents
@using CraftConnect.WASM.ViewModels
@using Blazored.FluentValidation

<div class="checkout-page">
    <h1 class="page-title">Secure Checkout</h1>

    <EditForm Model="checkoutModel" OnValidSubmit="HandleCheckout">
        <DataAnnotationsValidator />

        <div class="checkout-grid">
            <!-- Left Column: Order Summary & Payment Method -->
            <div class="checkout-column-left">
                <YourOrder OrderItems="checkoutModel.OrderItems" Total="checkoutModel.Total" />
                <PaymentMethodSelector @bind-PaymentMethod="checkoutModel.PaymentMethod" />
            </div>

            <!-- Right Column: Details & Billing -->
            <div class="checkout-column-right">
                @if (checkoutModel.PaymentMethod == "CreditCard")
                {
                    <PaymentDetails @bind-CardNumber="checkoutModel.CardNumber"
                                    @bind-ExpirationDate="checkoutModel.ExpirationDate"
                                    @bind-Cvc="checkoutModel.Cvc"
                                    @bind-NameOnCard="checkoutModel.NameOnCard" />
                }

                <BillingInformation @bind-BillingSameAsRegistered="checkoutModel.BillingSameAsRegistered"
                                    @bind-StreetAddress="checkoutModel.StreetAddress"
                                    @bind-City="checkoutModel.City"
                                    @bind-State="checkoutModel.State"
                                    @bind-ZipCode="checkoutModel.ZipCode"
                                    @bind-Country="checkoutModel.Country" />

                <div class="submit-section">
                    <button type="submit" class="btn-submit" disabled="@isProcessing">
                        @if (isProcessing)
                        {
                            <span class="spinner-border spinner-border-sm me-2"></span>
                            <span>Processing...</span>
                        }
                        else
                        {
                            <i class="bi bi-lock-fill"></i>
                            <span>Pay $@checkoutModel.Total.ToString("F2")</span>
                        }
                    </button>

                    <div class="ssl-badge">
                        <i class="bi bi-shield-lock-fill"></i>
                        <span>SSL Secured Payment</span>
                    </div>
                </div>
            </div>
        </div>
    </EditForm>
</div>

@code {
    private CheckoutViewModel checkoutModel = new();
    private bool isProcessing = false;

    protected override void OnInitialized()
    {
        // Mock data initialization
        checkoutModel.OrderItems = new List<OrderSummaryItem>
        {
            new OrderSummaryItem { Name = "Custom Oak Bookshelf", Price = 150.00m },
            new OrderSummaryItem { Name = "Service Fee", Price = 120.00m },
            new OrderSummaryItem { Name = "Platform Fee", Price = 15.00m },
            new OrderSummaryItem { Name = "Taxes", Price = 15.00m }
        };
        // ... pre-fill logic ...
    }

    private async Task HandleCheckout()
    {
        isProcessing = true;
        // Simulate API call
        await Task.Delay(2000);
        Console.WriteLine("Checkout submitted");
        isProcessing = false;
    }
}