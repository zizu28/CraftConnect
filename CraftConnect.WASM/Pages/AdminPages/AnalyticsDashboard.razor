@page "/admin/analytics"
@layout AdminLayout
@using CraftConnect.WASM.Components.AdminPagesComponents.AnalyticsDashboardPageComponents
@using CraftConnect.WASM.Layout.AdminPageLayouts
@using CraftConnect.WASM.ViewModels

<div class="analytics-container">
    <!-- Page Header -->
    <header class="page-header">
        <h1>Analytics Dashboard</h1>
        <div class="header-actions">
            <select class="filter-dropdown" @bind="dateFilter">
                <option value="30">Last 30 days</option>
                <option value="60">Last 60 days</option>
                <option value="90">Last 90 days</option>
            </select>
            <button class="btn btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 10-1.09-1.03l-2.955 3.129V2.75z" /><path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" /></svg>
                Export Data
            </button>
        </div>
    </header>
    <p class="page-description">
        View and analyze platform growth and key metrics.
    </p>

    <!-- Stat Cards -->
    <div class="stat-cards-grid">
        <AnalyticsStatCard Title="New Sign-ups" Value="@stats.NewSignUps.ToString("N0")" Change="@stats.NewSignUpsChange" IsPositive="true" />
        <AnalyticsStatCard Title="Active Users" Value="@stats.ActiveUsers.ToString("N0")" Change="@stats.ActiveUsersChange" IsPositive="true" />
        <AnalyticsStatCard Title="New Projects" Value="@stats.NewProjects.ToString("N0")" Change="@stats.NewProjectsChange" IsPositive="true" />
        <AnalyticsStatCard Title="Revenue" Value="@stats.Revenue.ToString("C")" Change="@stats.RevenueChange" IsPositive="true" />
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
        <div class="chart-card-large">
            <NewSignupsChart />
        </div>
        <div class="chart-card-small">
            <UserBreakdownChart />
        </div>
        <div class="chart-card-small">
            <ProjectActivityChart />
        </div>
    </div>

    <!-- Top Craftsmen Table -->
    <TopCraftsmenTable Craftsmen="topCraftsmen" />

</div>

@code {
    private AdminDashboardStats stats = new();
    private string dateFilter = "";
    private List<TopCraftsman> topCraftsmen = new();
    // private List<TopCraftsman> filteredTopCraftsmen
    // {
    //     get
    //     {
    //         var craftsmen = topCraftsmen.AsEnumerable();
    //         if (!string.IsNullOrWhiteSpace(dateFilter))
    //         {
    //             craftsmen = dateFilter.ToLower() switch
    //             {
    //                 "30" => craftsmen.Where(c => c.);
    //                 _ => craftsmen
    //             };
    //         }
    //         return craftsmen.ToList();
    //     }
    // }

    protected override void OnInitialized()
    {
        // Mock data from the image
        stats = new AdminDashboardStats
        {
            NewSignUps = 1234,
            NewSignUpsChange = "+5% from last month",
            ActiveUsers = 5678,
            ActiveUsersChange = "+3% from last month",
            NewProjects = 890,
            NewProjectsChange = "+8% from last month",
            Revenue = 12345,
            RevenueChange = "+12% from last month"
        };

        topCraftsmen = new List<TopCraftsman>
        {
            new TopCraftsman { Id = Guid.NewGuid(), AvatarUrl = "https://placehold.co/40x40/E2E8F0/475569?text=JD", Name = "John Doe", Category = "Woodworking", CompletedProjects = 24, Rating = 4.9 },
            new TopCraftsman { Id = Guid.NewGuid(), AvatarUrl = "https://placehold.co/40x40/E2E8F0/475569?text=JS", Name = "Jane Smith", Category = "Pottery", CompletedProjects = 18, Rating = 4.8 },
            new TopCraftsman { Id = Guid.NewGuid(), AvatarUrl = "https://placehold.co/40x40/E2E8F0/475569?text=SW", Name = "Sam Wilson", Category = "Metalwork", CompletedProjects = 15, Rating = 4.7 }
        };
    }
}