@page "/admin/payments/transaction-fees"
@layout AdminLayout
@using Core.SharedKernel.Enums
@using CraftConnect.WASM.Layout.AdminPageLayouts
@using CraftConnect.WASM.Components.AdminPagesComponents.UserManagementPageComponent
@using CraftConnect.WASM.ViewModels

<div class="fees-container">
    <!-- Page Header -->
    <header class="page-header">
        <div class="header-title">
            <nav class="breadcrumbs">
                <a href="/admin/dashboard">Dashboard</a>
                <span>/</span>
                <a href="/admin/payments">Payments</a>
                <span>/</span>
                <span class="current">Transaction Fees</span>
            </nav>
            <h1>Transaction Fee Management</h1>
            <p class="page-description">
                Define, edit, and apply fee structures for platform transactions.
            </p>
        </div>
        <button class="btn btn-primary">
            <i class="bi bi-plus-lg"></i>
            Add New Fee Rule
        </button>
    </header>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="search-input-wrapper">
            <i class="bi bi-search"></i>
            <input type="text" placeholder="Search by rule name..." />
        </div>
        <div class="filter-group">
            <select id="feeType" @bind="feeTypeFilter">
                <option value="all">Fee Type: All</option>
                <option value="percentage">Percentage</option>
                <option value="fixed">Fixed Amount</option>
            </select>
            <select id="status" @bind="statusFilter">
                <option value="all">Status: All</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
            </select>
            <button class="btn-icon">
                <i class="bi bi-funnel-fill"></i>
            </button>
        </div>
    </div>

    <!-- Table Container -->
    <div class="table-container">
        <table class="fees-table">
            <thead>
                <tr>
                    <th class="col-checkbox"><input type="checkbox" /></th>
                    <th>Rule Name</th>
                    <th>Fee Type</th>
                    <th>Fee Value</th>
                    <th>Applies To</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var fee in filteredFeeRules)
                {
                    <tr>
                        <td class="col-checkbox"><input type="checkbox" /></td>
                        <td class="cell-rule-name">@fee.RuleName</td>
                        <td>@fee.FeeType</td>
                        <td>@GetFormattedValue(fee)</td>
                        <td>@fee.AppliesTo</td>
                        <td>
                            <AdminStatusBadge Status="@fee.Status" />
                        </td>
                        <td class="cell-actions">
                            <button class="btn-icon-action" title="Edit">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn-icon-action btn-danger" title="Delete">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

</div>

@code {
    private List<AdminTransactionFee> feeRules = new();
    private List<AdminTransactionFee> filteredFeeRules
    {
        get
        {
            var fees = feeRules.AsEnumerable();
            if (!string.IsNullOrWhiteSpace(feeTypeFilter))
            {
                fees = feeTypeFilter.ToLower() switch
                {
                    "all" => fees,
                    "percentage" => fees.Where(f => f.FeeType.ToString().Contains("Percentage", StringComparison.OrdinalIgnoreCase)),
                    "fixed" => fees.Where(f => f.FeeType.ToString().Contains("FixedAmount", StringComparison.OrdinalIgnoreCase)),
                    _ => fees
                };
            }

            if (!string.IsNullOrWhiteSpace(statusFilter))
            {
                fees = statusFilter.ToLower() switch
                {
                    "all" => fees,
                    "active" => fees.Where(f => f.Status.ToString().Equals("Active", StringComparison.OrdinalIgnoreCase)),
                    "inactive" => fees.Where(f => f.Status.ToString().Contains("Inactive", StringComparison.OrdinalIgnoreCase)),
                    _ => fees
                };
            }

            return fees.ToList();
        }
    }
    private string feeTypeFilter = "";
    private string statusFilter = "";

    protected override void OnInitialized()
    {
        // Mock data from the image
        feeRules = new List<AdminTransactionFee>
        {
            new AdminTransactionFee { Id = Guid.NewGuid(), RuleName = "Standard Platform Commission", FeeType = DiscountType.Percentage, FeeValue = 5, AppliesTo = "All Transactions", Status = UserStatus.Active },
            new AdminTransactionFee { Id = Guid.NewGuid(), RuleName = "Fixed Payment Processing Fee", FeeType = DiscountType.FixedAmount, FeeValue = 2.50m, AppliesTo = "All Transactions", Status = UserStatus.Active },
            new AdminTransactionFee { Id = Guid.NewGuid(), RuleName = "Featured Project Fee", FeeType = DiscountType.FixedAmount, FeeValue = 15.00m, AppliesTo = "Specific Service", Status = UserStatus.Active },
            new AdminTransactionFee { Id = Guid.NewGuid(), RuleName = "High-Value Project Commission", FeeType = DiscountType.Percentage, FeeValue = 3, AppliesTo = "Projects > $5000", Status = UserStatus.Active },
            new AdminTransactionFee { Id = Guid.NewGuid(), RuleName = "Legacy Artisan Rate", FeeType = DiscountType.Percentage, FeeValue = 2.5m, AppliesTo = "Specific User Role", Status = UserStatus.Inactive }
        };
    }

    private string GetFormattedValue(AdminTransactionFee fee)
    {
        return fee.FeeType == DiscountType.Percentage ? $"{fee.FeeValue}%" : fee.FeeValue.ToString("C");
    }
}