@page "/admin/payments/payouts"
@layout AdminLayout
@using CraftConnect.WASM.Layout.AdminPageLayouts
@using CraftConnect.WASM.Components.AdminPagesComponents.PayoutScheduledManagementPageComponents
@using CraftConnect.WASM.ViewModels

<div class="payouts-container">
    <!-- Page Header -->
    <header class="page-header">        
        <div class="header-title">
            <nav class="breadcrumbs">
                <a href="/admin/dashboard">Dashboard</a>
                <span>/</span>
                <a href="/admin/payments">Payments</a>
                <span>/</span>
                <span class="current">Payouts</span>
            </nav>
        </div>
        <h1>Payout Schedule Management</h1>
    </header>

    <!-- Default Payout Configuration Card -->
    <div class="config-card">
        <h4>Default Payout Configuration</h4>
        <div class="config-form">
            <div class="form-group">
                <label for="payoutFrequency">Payout Frequency</label>
                <select id="payoutFrequency" @bind="config.Frequency">
                    <option value="Daily">Daily</option>
                    <option value="Weekly">Weekly</option>
                    <option value="BiWeekly">Bi-Weekly</option>
                    <option value="Monthly">Monthly</option>
                </select>
            </div>
            <div class="form-group">
                <label for="minimumThreshold">Minimum Payout Threshold</label>
                <div class="input-with-currency">
                    <span>$</span>
                    <input type="number" id="minimumThreshold" @bind="config.MinimumThreshold" />
                </div>
            </div>
            <button class="btn btn-primary" @onclick="SaveChanges">Save Changes</button>
        </div>
    </div>

    <!-- Payouts Table Section -->
    <div class="payouts-list-section">
        <!-- Tabs -->
        <nav class="tab-nav">
            <button class="@(activeTab == 1 ? "tab-link active" : "tab-link")" @onclick="() => SelectTab(1)">Pending Payouts</button>
            <button class="@(activeTab == 2 ? "tab-link active" : "tab-link")" @onclick="() => SelectTab(2)">Payout History</button>
        </nav>

        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="search-input-wrapper">
                <i class="bi bi-search"></i>
                <input type="text" placeholder="Search by artisan..." />
            </div>
            <div class="filter-actions">
                <button class="btn btn-secondary">
                    <i class="bi bi-funnel-fill"></i>
                    Filter
                </button>
                <button class="btn btn-primary" disabled="@(SelectedPayoutCount == 0)">
                    Approve Selected (@SelectedPayoutCount)
                </button>
            </div>
        </div>

        <!-- Table -->
        <div class="table-container">
            <table class="payouts-table">
                <thead>
                    <tr>
                        <th class="col-checkbox"><input type="checkbox" @onchange="ToggleSelectAll" /></th>
                        <th>Artisan Name</th>
                        <th>Amount</th>
                        <th>Scheduled Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var payout in Payouts)
                    {
                        <tr>
                            <td class="col-checkbox"><input type="checkbox" @bind="payout.IsSelected" /></td>
                            <td class="cell-artisan-name">@payout.ArtisanName</td>
                            <td>@payout.Amount.ToString("C")</td>
                            <td>@payout.ScheduledDate.ToString("yyyy-MM-dd")</td>
                            <td>
                                <PayoutStatusBadge Status="@payout.Status" />
                            </td>
                            <td class="cell-actions">
                                @if (payout.Status == "Pending")
                                {
                                    <a href="#" class="action-link-approve">Approve</a>
                                }
                                @if (payout.Status == "In Progress")
                                {
                                    <a href="#" class="action-link-default">View Details</a>
                                }
                                @if (payout.Status == "Failed")
                                {
                                    <a href="#" class="action-link-danger">Retry</a>
                                }
                                @if (payout.Status == "Paid")
                                {
                                    <a href="#" class="action-link-default">View Receipt</a>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        
        <!-- Table Footer -->
        <div class="table-footer">
            <span>Showing 1 to 5 of 100</span>
            <PayoutPagination />
        </div>
    </div>
</div>

@code {
    private PayoutScheduleConfig config = new();
    private List<PendingPayout> Payouts = new();
    private int activeTab = 1;

    private int SelectedPayoutCount => Payouts.Count(p => p.IsSelected);

    protected override void OnInitialized()
    {
        // Mock data from the image
        Payouts = new List<PendingPayout>
        {
            new PendingPayout { Id = Guid.NewGuid(), ArtisanName = "Elena Rodriguez", Amount = 450.00m, ScheduledDate = new DateTime(2024, 7, 25), Status = "Pending", IsSelected = false },
            new PendingPayout { Id = Guid.NewGuid(), ArtisanName = "Ben Carter", Amount = 1230.50m, ScheduledDate = new DateTime(2024, 7, 25), Status = "Pending", IsSelected = true },
            new PendingPayout { Id = Guid.NewGuid(), ArtisanName = "Marcus Singh", Amount = 875.20m, ScheduledDate = new DateTime(2024, 7, 25), Status = "In Progress", IsSelected = false },
            new PendingPayout { Id = Guid.NewGuid(), ArtisanName = "Aisha Khan", Amount = 2500.00m, ScheduledDate = new DateTime(2024, 7, 18), Status = "Failed", IsSelected = false },
            new PendingPayout { Id = Guid.NewGuid(), ArtisanName = "Olivia Chen", Amount = 320.00m, ScheduledDate = new DateTime(2024, 7, 18), Status = "Paid", IsSelected = false }
        };
    }

    private void ToggleSelectAll(ChangeEventArgs e)
    {
        bool isSelected = (bool)(e.Value ?? false);
        Payouts.ForEach(p => p.IsSelected = isSelected);
    }

    private void SelectTab(int tabIndex)
    {
        activeTab = tabIndex;
        // In a real app, you'd reload data here based on the tab
    }
    
    private void SaveChanges()
    {
        // Logic to save config changes
        Console.WriteLine("Saving config...");
    }
}