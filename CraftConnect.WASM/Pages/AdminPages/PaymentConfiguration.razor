@page "/admin/payments"
@layout AdminLayout
@inject NavigationManager NavigationManager
@using CraftConnect.WASM.Layout.AdminPageLayouts
@using CraftConnect.WASM.Components.AdminPagesComponents.PaymentConfigurationPageComponents
@using CraftConnect.WASM.ViewModels

<div class="payment-config-container">
    <!-- Page Header -->
    <header class="page-header">
        <h1>Payment Configurations</h1>
        <a href="/admin/logs/transactions" class="view-logs-link">
            View Transaction Logs
            <i class="bi bi-arrow-right"></i>
        </a>
    </header>
    <p class="page-description">
        Manage payment gateway integrations, transaction fees, and payout schedules.
    </p>

    <!-- Tab Navigation -->
    <nav class="tab-nav">
        <button class="@(activeTab == 1 ? "tab-link active" : "tab-link")" @onclick="() => SelectTab(1)">Gateway Integrations</button>
        <button class="@(activeTab == 2 ? "tab-link active" : "tab-link")" @onclick="@(() => SelectTab(2, true, "/admin/payments/transaction-fees"))">Transaction Fees</button>
        <button class="@(activeTab == 3 ? "tab-link active" : "tab-link")" @onclick="@(() => SelectTab(3, true, "/admin/payments/payouts"))">Payout Schedules</button>
        <button class="@(activeTab == 4 ? "tab-link active" : "tab-link")" @onclick="@(() => SelectTab(4, true, "/admin/payments/currency-settings"))">Currency Settings</button>
    </nav>

    <!-- Tab Content -->
    <div class="tab-content">
        @if (activeTab == 1)
        {
            <div class="gateway-list">
                @foreach (var gateway in gateways)
                {
                    <GatewayCard Gateway="gateway" OnToggle="() => gateway.IsEnabled = !gateway.IsEnabled" />
                }

                @* <div class="add-new-gateway-card">
                    <div class="add-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>
                    </div>
                    <div class="add-text">
                        <h5>Add New Gateway</h5>
                        <p>Connect another payment provider</p>
                    </div>
                    <button class="btn btn-add" @onclick="AddPaymentGateway">Add</button>
                </div> *@
            </div>
        }
        @if (activeTab == 2)
        {
            <p>Transaction Fees content goes here...</p>
        }
        @if (activeTab == 3)
        {
            <p>Payout Schedules content goes here...</p>
        }
        @if (activeTab == 4)
        {
            <p>Currency Settings content goes here...</p>
        }
    </div>

</div>

@code {
    private int activeTab = 1;
    private List<AdminPaymentGateway> gateways = new();

    protected override void OnInitialized()
    {
        // Mock data from the image
        gateways = new List<AdminPaymentGateway>
        {
            new AdminPaymentGateway 
            { 
                Id = Guid.NewGuid(), 
                Name = "Stripe", 
                ApiKey = "sk_test_****************", 
                IsConfigured = true, 
                IsEnabled = true 
            },
            new AdminPaymentGateway 
            { 
                Id = Guid.NewGuid(),
                Name = "Bank Transfer", 
                ApiKey = "Not configured", 
                IsConfigured = false, 
                IsEnabled = false 
            },
            new AdminPaymentGateway
            {
                Id = Guid.NewGuid(),
                Name = "Mobile Money",
                ApiKey = "Not configured",
                IsConfigured = false,
                IsEnabled = false
            }
        };
    }

    private void SelectTab(int tabIndex, bool navigate = false, string? url = null)
    {
        activeTab = tabIndex;
        if(navigate == true)
        {
            NavigationManager.NavigateTo(url);
        }
    }

    private void AddPaymentGateway()
    {
        var gateway = new AdminPaymentGateway
        {
            Id = Guid.NewGuid(),
            Name = "Mobile Money",
            IsConfigured = false,
            IsEnabled = false
        };
        gateways.Add(gateway);
    }
}