@page "/admin/moderation"
@layout AdminLayout
@using Core.SharedKernel.Enums
@using CraftConnect.WASM.Layout.AdminPageLayouts
@using CraftConnect.WASM.ViewModels

<div classclass="moderation-container">
    <!-- Page Header -->
    <header class="page-header">
        <h1>Content Moderation</h1>
    </header>

    <!-- Main Content Area -->
    <div class="moderation-layout">

        <!-- Column 1: Report List -->
        <div class="report-list-column">
            <div class="filter-header">
                <div class="search-input-wrapper">
                    <i class="bi bi-search"></i>
                    <input type="text" placeholder="Search reports..." />
                </div>
                <nav class="tab-nav">
                    <button class="@(activeTab == 1 ? "tab-link active" : "tab-link")" @onclick="() => SelectTab(1)">
                        All <span class="count-badge">5</span>
                    </button>
                    <button class="@(activeTab == 2 ? "tab-link active" : "tab-link")" @onclick="() => SelectTab(2)">
                        Pending
                    </button>
                    <button class="@(activeTab == 3 ? "tab-link active" : "tab-link")" @onclick="() => SelectTab(3)">
                        Resolved
                    </button>
                </nav>
            </div>

            <div class="report-list">
                @foreach (var item in reportedItems)
                {
                    <div class="@($"report-item {(selectedReportId == item.Id ? "active" : "")}")" @onclick="() => SelectReport(item.Id)">
                        <div class="report-icon">
                            @GetIconForReport(item.Type)
                        </div>
                        <div class="report-details">
                            <span class="report-title">@item.Title</span>
                            <span class="report-info">@item.ReporterInfo</span>
                            <span class="report-time">@item.Timestamp.ToString("MMM dd, yyyy")</span>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Column 2: Content Preview -->
        <div class="content-preview-column">
            @if (selectedReportId != Guid.Empty)
            {
                <h4 class="preview-title">Reviewing Profile: 'Inappropriate Profile: John D.'</h4>
                <div class="preview-content">
                    <h5 class="preview-header">Content Preview</h5>
                    <div class="profile-preview">
                        <img src="https://placehold.co/150x150/e0e7ff/4f46e5?text=JD" alt="User Avatar" class="profile-avatar" />
                        <div class="profile-details">
                            <h4>John D.</h4>
                            <p>"Expert in quantum carpentry. Building furniture that exists and doesn't exist at the same time. Contact me for a consultation."</p>
                        </div>
                    </div>
                </div>
                <div class="preview-actions">
                    <button class="btn btn-action-secondary">Reject Report</button>
                    <button class="btn btn-action-success">Approve</button>
                    <button class="btn btn-action-warning">Suspend User</button>
                    <button class="btn btn-action-danger">Ban User</button>
                </div>
            }
            else
            {
                <div class="empty-state">
                    <i class="bi bi-clipboard-x" style="font-size: 3rem;"></i>
                    <p>Select a report to review</p>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private int activeTab = 1;
    private Guid selectedReportId;
    private List<ReportedItem> reportedItems = new();

    protected override void OnInitialized()
    {
        reportedItems = new List<ReportedItem>
        {
            new ReportedItem { Id = Guid.NewGuid(), Title = "Inappropriate Profile: John D.", ReporterInfo = "Reported by Jane S. for Misleading information", Timestamp = new DateTime(2023, 10, 27), Type = ReportType.Profile, Status = "Pending" },
            new ReportedItem { Id = Guid.NewGuid(), Title = "Offensive Message in 'Project Discussion'", ReporterInfo = "Reported by Mike R. for Harassment", Timestamp = new DateTime(2023, 10, 26), Type = ReportType.Message, Status = "Pending" },
            new ReportedItem { Id = Guid.NewGuid(), Title = "Fake Review on 'Handcrafted Wallets'", ReporterInfo = "Reported by Sarah L. for Spam", Timestamp = new DateTime(2023, 10, 25), Type = ReportType.Review, Status = "Pending" },
            new ReportedItem { Id = Guid.NewGuid(), Title = "Misleading Project: 'Instant Home Repairs'", ReporterInfo = "Reported by Tom B. for Scam", Timestamp = new DateTime(2023, 10, 24), Type = ReportType.Project, Status = "Pending" }
        };
    }

    private void SelectTab(int tabIndex)
    {
        activeTab = tabIndex;
        // Logic to filter reports based on tab
    }

    private void SelectReport(Guid reportId)
    {
        selectedReportId = reportId;
    }

    private MarkupString GetIconForReport(ReportType type)
    {
        string iconClass = type switch
        {
            ReportType.Profile => "bi-person-badge-fill",
            ReportType.Message => "bi-chat-dots-fill",
            ReportType.Review => "bi-star-fill",
            _ => "bi-flag-fill"
        };
        return new MarkupString($"<i class='bi {iconClass}'></i>");
    }
}