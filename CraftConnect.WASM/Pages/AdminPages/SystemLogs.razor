@page "/admin/logs"
@layout AdminLayout
@using CraftConnect.WASM.Layout.AdminPageLayouts
@using CraftConnect.WASM.Components.AdminPagesComponents.SystemLogsPageComponents
@using CraftConnect.WASM.ViewModels

<div class="logs-container">
    <!-- Page Header -->
    <header class="page-header">
        <h1>System Logs & Audit Trail</h1>
        <button class="btn btn-secondary">
            <i class="bi bi-download"></i>
            Export Logs
        </button>
    </header>
    <p class="page-description">
        Monitor system events, user actions, and administrative activities.
    </p>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="filter-group">
            <label for="startDate">Start Date</label>
            <div class="date-input-wrapper">
                <input type="text" id="startDate" placeholder="mm/dd/yyyy" />
                <i class="bi bi-calendar"></i>
            </div>
        </div>
        <div class="filter-group">
            <label for="endDate">End Date</label>
            <div class="date-input-wrapper">
                <input type="text" id="endDate" placeholder="mm/dd/yyyy" />
                <i class="bi bi-calendar"></i>
            </div>
        </div>
        <div class="filter-group">
            <label for="eventType">Event Type</label>
            <select id="eventType" @bind="eventFilter">
                <option value="">All Events</option>
                <option value="user-login">User Login</option>
                <option value="profile-update">Profile Update</option>
                <option value="project-deletion">Project Deletion</option>
                <option value="password-reset">Password Reset</option>
            </select>
        </div>
        <div class="filter-group filter-search">
            <label for="userSearch">User ID or Username</label>
            <div class="search-input-wrapper">
                <input type="text" id="userSearch" placeholder="Search by user" />
                <i class="bi bi-search"></i>
            </div>
        </div>
        <div class="filter-buttons">
            <button class="btn btn-primary">Apply Filters</button>
            <button class="btn btn-tertiary">Clear Filters</button>
        </div>
    </div>

    <!-- Table Container -->
    <div class="table-container">
        <table class="logs-table">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>Event Type</th>
                    <th>User</th>
                    <th>Details</th>
                    <th>IP Address</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var log in filteredLogs)
                {
                    <tr>
                        <td class="cell-timestamp">@log.Timestamp.ToString("yyyy-MM-dd HH:mm:ss")</td>
                        <td><LogTypeBadge EventType="@log.EventType" /></td>
                        <td class="cell-user">@log.User</td>
                        <td class="cell-details">@log.Details</td>
                        <td class="cell-ip">@log.IpAddress</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="table-footer">
        <span class="pagination-summary">Showing <strong>1-5</strong> of <strong>@filteredLogs.Count</strong></span>
        <AdminLogsPagination CurrentPage="currentPage" TotalPages="@TotalPages" OnPageChanged="OnPageSelected" />
    </div>
</div>

@code {
    private string eventFilter = "";
    private List<AdminSystemLog> logs = new();
    private List<AdminSystemLog> filteredLogs
    {
        get
        {
            var logObj = logs.AsEnumerable();
            if (!string.IsNullOrWhiteSpace(eventFilter))
            {
                logObj = eventFilter.ToLower() switch
                {
                    "user-login" => logObj.Where(l => l.EventType.Equals("User Login", StringComparison.OrdinalIgnoreCase)),
                    "profile-update" => logObj.Where(l => l.EventType.Equals("Profile Update", StringComparison.OrdinalIgnoreCase)),
                    "project-deletion" => logObj.Where(l => l.EventType.Equals("Project Deletion", StringComparison.OrdinalIgnoreCase)),
                    "password-reset" => logObj.Where(l => l.EventType.Equals("Password Reset", StringComparison.OrdinalIgnoreCase)),
                    _ => logObj
                };
            }
            TotalPages = logObj.Count() / 5;
            return logObj.ToList();
        }
    }
    private int TotalPages;
    private int currentPage = 1;

    protected override void OnInitialized()
    {
        // Mock data from the image
        logs = new List<AdminSystemLog>
        {
            new AdminSystemLog { Id = 1, Timestamp = new DateTime(2023, 10, 27, 14, 30, 15), EventType = "User Login", User = "craftsman_jane", Details = "Logged in successfully", IpAddress = "192.168.1.1" },
            new AdminSystemLog { Id = 2, Timestamp = new DateTime(2023, 10, 27, 14, 25, 02), EventType = "Profile Update", User = "admin_user", Details = "Updated user 'craftsman_jane' profile", IpAddress = "127.0.0.1" },
            new AdminSystemLog { Id = 3, Timestamp = new DateTime(2023, 10, 26, 18, 00, 45), EventType = "Project Deletion", User = "craftsman_john", Details = "Deleted project 'Custom Bookshelf'", IpAddress = "203.0.113.5" },
            new AdminSystemLog { Id = 4, Timestamp = new DateTime(2023, 10, 26, 09, 30, 05), EventType = "Password Reset", User = "customer_mike", Details = "Password reset request initiated", IpAddress = "198.51.100.2" },
            new AdminSystemLog { Id = 5, Timestamp = new DateTime(2023, 10, 25, 11, 20, 10), EventType = "Profile Update", User = "craftsman_jane", Details = "Updated profile: 'Skills'", IpAddress = "192.168.1.1" }
        };
    }

    private void OnPageSelected(int page)
    {
        currentPage = page;
        // Add logic here to fetch data for the new page
    }
}