@page "/admin/email-templates"
@layout AdminLayout
@using CraftConnect.WASM.Layout.AdminPageLayouts
@using CraftConnect.WASM.ViewModels

<div class="email-template-container">
    <!-- Page Header -->
    <header class="page-header">
        <h1>Manage Email Templates</h1>
        <p class="page-description">
            Create, edit, and manage email templates for platform communications.
        </p>
    </header>

    <!-- Main Content -->
    <div class="email-layout">
        
        <!-- Column 1: Template List -->
        <div class="template-list-column">
            <button class="btn btn-primary btn-create-new">
                <i class="bi bi-plus-lg"></i>
                Create New Template
            </button>
            <div class="search-input-wrapper">
                <i class="bi bi-search"></i>
                <input type="text" placeholder="Search templates..." />
            </div>

            <div class="template-list">
                @foreach (var template in templates)
                {
                    <div class="@($"template-item {(selectedTemplate?.Id == template.Id ? "active" : "")}")" @onclick="() => SelectTemplate(template)">
                        <div class="template-icon">
                            @GetIconForTemplate(template.Icon)
                        </div>
                        <div class="template-details">
                            <span class="template-title">@template.Title</span>
                            <span class="template-description">@template.Description</span>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Column 2: Template Editor -->
        <div class="template-editor-column">
            @if (selectedTemplate != null)
            {
                <div class="editor-card">
                    <div class="form-group">
                        <label for="templateName">Template Name</label>
                        <input type="text" id="templateName" class="form-control" @bind="selectedTemplate.Title" />
                    </div>

                    <div class="form-group">
                        <label for="subjectLine">Subject Line</label>
                        <input type="text" id="subjectLine" class="form-control" @bind="selectedTemplate.Subject" />
                    </div>

                    <div class="form-group">
                        <label for="emailBody">Email Body</label>
                        <div class="wysiwyg-toolbar">
                            <button class="toolbar-btn"><i class="bi bi-type-bold"></i></button>
                            <button class="toolbar-btn"><i class="bi bi-type-italic"></i></button>
                            <button class="toolbar-btn"><i class="bi bi-list-ul"></i></button>
                            <button class="toolbar-btn"><i class="bi bi-list-ol"></i></button>
                            <button class="toolbar-btn"><i class="bi bi-link-45deg"></i></button>
                            <button class="toolbar-btn"><i class="bi bi-image"></i></button>
                            <button class="toolbar-btn"><i class="bi bi-arrow-counterclockwise"></i></button>
                            <button class="toolbar-btn">Placeholders</button>
                        </div>
                        <textarea id="emailBody" class="form-control" rows="15" @bind="selectedTemplate.Body"></textarea>
                    </div>

                    <div class="editor-footer">
                        <button class="btn btn-secondary">Cancel</button>
                        <button class="btn btn-danger">Delete</button>
                        <button class="btn btn-secondary-gray">Preview</button>
                        <button class="btn btn-success">Save Changes</button>
                    </div>
                </div>
            }
            else
            {
                <div class="empty-state">
                    <i class="bi bi-envelope-open" style="font-size: 3rem;"></i>
                    <p>Select a template to view or edit</p>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private List<AdminEmailTemplate> templates = new();
    private AdminEmailTemplate? selectedTemplate;

    protected override void OnInitialized()
    {
        templates = new List<AdminEmailTemplate>
        {
            new AdminEmailTemplate 
            { 
                Id = Guid.NewGuid(),
                Title = "Welcome Email", 
                Description = "Sent to new users upon registration.", 
                Icon = "welcome", 
                Subject = "Welcome to Craftsmen Connect, {{user_name}}!",
                Body = "Hi {{user_name}},\n\nWelcome to Craftsmen Connect! We're thrilled to have you join our community of skilled craftsmen and discerning customers.\n\nTo get started, we recommend completing your profile to showcase your skills and attract potential clients.\n[Complete Your Profile Button]\n\nIf you have any questions, feel free to reach out to our support team.\n\nBest,\nThe Craftsmen Connect Team"
            },
            new AdminEmailTemplate { Id = Guid.NewGuid(), Title = "Password Reset", Description = "Email for users who forgot their password.", Icon = "password" },
            new AdminEmailTemplate { Id = Guid.NewGuid(), Title = "New Service Request", Description = "Notification for craftsmen.", Icon = "request" },
            new AdminEmailTemplate { Id = Guid.NewGuid(), Title = "Project Completion", Description = "Confirmation for customers.", Icon = "completion" },
            new AdminEmailTemplate { Id = Guid.NewGuid(), Title = "Weekly Digest", Description = "Weekly updates for craftsmen.", Icon = "digest" }
        };
        selectedTemplate = templates[0]; // Select the first one by default
    }

    private void SelectTemplate(AdminEmailTemplate template)
    {
        selectedTemplate = template;
    }

    private MarkupString GetIconForTemplate(string icon)
    {
        string iconClass = icon switch
        {
            "password" => "bi-shield-lock",
            "request" => "bi-tools",
            "completion" => "bi-check2-circle",
            "digest" => "bi-journal-text",
            _ => "bi-stars" // Default: Welcome
        };
        return new MarkupString($"<i class='bi {iconClass}'></i>");
    }
}