@page "/admin/announcements"
@layout AdminLayout
@using Core.SharedKernel.Enums
@using CraftConnect.WASM.Layout.AdminPageLayouts
@using CraftConnect.WASM.Components.AdminPagesComponents.ManagementAnnouncementPageComponents
@using CraftConnect.WASM.ViewModels

<div class="announcement-management-container">
    <!-- Page Header -->
    <header class="page-header">
        <h1>Manage Announcements</h1>
        <button class="btn btn-primary">
            <i class="bi bi-plus-lg"></i>
            Create New Announcement
        </button>
    </header>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="search-container">
            <i class="search-icon bi bi-search"></i>
            <input type="text" class="search-input" placeholder="Search by title or keyword" />
        </div>
        <div class="dropdown-filters">
            <select class="filter-dropdown" @bind="statusFilter">
                <option value="">Status</option>
                <option value="Published">Published</option>
                <option value="Scheduled">Scheduled</option>
                <option value="Draft">Draft</option>
            </select>
            <select class="filter-dropdown" @bind="audienceFilter">
                <option value="">Target Audience</option>
                <option value="all-users">All Users</option>
                <option value="craftsmen/Women">Craftsmen/Women</option>
                <option value="customers">Customers</option>
            </select>
        </div>
    </div>

    <!-- Announcements Table -->
    <div class="table-container">
        <table class="announcement-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Publication Date</th>
                    <th>Status</th>
                    <th>Target Audience</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var announcement in filteredAnnouncements)
                {
                    <tr>
                        <td class="cell-title">@announcement.Title</td>
                        <td>@announcement.PublicationDate.ToString("yyyy-MM-dd")</td>
                        <td><AnnouncementStatusBadge Status="announcement.Status" /></td>
                        <td>@announcement.TargetAudience</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn-icon" title="Delete">
                                    <i class="bi bi-trash"></i>
                                </button>
                                <button class="btn-icon" title="Archive">
                                    <i class="bi bi-archive"></i>
                                </button>
                                <button class="btn-icon" title="Duplicate">
                                    <i class="bi bi-copy"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@code {
    private static string audienceFilter = "";
    private static string statusFilter = "";
    private List<AdminAnnouncement> allAnnouncements { get; set; } = [];
    private List<AdminAnnouncement> filteredAnnouncements { get
        {
            var announcements = allAnnouncements.AsEnumerable();
            if (!string.IsNullOrWhiteSpace(audienceFilter))
            {
                announcements = audienceFilter.ToLower() switch
                {
                    "all-users" => allAnnouncements.Where(an => an.TargetAudience.Contains("All Users", StringComparison.OrdinalIgnoreCase)).ToList(),
                    "craftsmen/women" => allAnnouncements.Where(an => an.TargetAudience.Contains("Craftsmen/Women", StringComparison.OrdinalIgnoreCase)).ToList(),
                    "customers" => allAnnouncements.Where(an => an.TargetAudience.Contains("Customers", StringComparison.OrdinalIgnoreCase)).ToList(),
                    _ => announcements
                };
            }

            if (!string.IsNullOrWhiteSpace(statusFilter))
            {
                announcements = statusFilter.ToLower() switch
                {
                    "published" => announcements.Where(an => an.Status.ToString().Contains("Published", StringComparison.OrdinalIgnoreCase)),
                    "scheduled" => announcements.Where(an => an.Status.ToString().Contains("Scheduled", StringComparison.OrdinalIgnoreCase)),
                    "draft" => announcements.Where(an => an.Status.ToString().Contains("Draft", StringComparison.OrdinalIgnoreCase)),
                    _ => announcements
                };
            }
            return announcements.ToList();
        }
    }
    

    protected override void OnInitialized()
    {
        // Mock data from the image
        allAnnouncements = new List<AdminAnnouncement>
        {
            new AdminAnnouncement { Id = Guid.NewGuid(), Title = "New Feature: Direct Messaging", PublicationDate = new DateTime(2023, 10, 26), Status = AnnouncementStatus.Published, TargetAudience = "All Users" },
            new AdminAnnouncement { Id = Guid.NewGuid(), Title = "Holiday Schedule Update", PublicationDate = new DateTime(2023, 11, 15), Status = AnnouncementStatus.Scheduled, TargetAudience = "Craftsmen/Women" },
            new AdminAnnouncement { Id = Guid.NewGuid(), Title = "Platform Maintenance", PublicationDate = new DateTime(2023, 10, 20), Status = AnnouncementStatus.Draft, TargetAudience = "All Users" },
            new AdminAnnouncement { Id = Guid.NewGuid(), Title = "Welcome to the new platform!", PublicationDate = new DateTime(2023, 9, 1), Status = AnnouncementStatus.Published, TargetAudience = "All Users" }
        };
    }
}