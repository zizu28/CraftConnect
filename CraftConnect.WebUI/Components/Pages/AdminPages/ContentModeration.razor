@page "/admin/moderation"
@layout AdminLayout
@using CraftConnect.WebUI.Components.Layout.AdminPageLayouts
@using CraftConnect.WebUI.Enums

<div classclass="moderation-container">
    <!-- Page Header -->
    <header class="page-header">
        <h1>Content Moderation</h1>
    </header>

    <!-- Main Content Area -->
    <div class="moderation-layout">

        <!-- Column 1: Report List -->
        <div class="report-list-column">
            <div class="filter-header">
                <div class="search-input-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" /></svg>
                    <input type="text" placeholder="Search reports..." />
                </div>
                <nav class="tab-nav">
                    <button class="@(activeTab == 1 ? "tab-link active" : "tab-link")" @onclick="() => SelectTab(1)">
                        All <span class="count-badge">5</span>
                    </button>
                    <button class="@(activeTab == 2 ? "tab-link active" : "tab-link")" @onclick="() => SelectTab(2)">
                        Pending
                    </button>
                    <button class="@(activeTab == 3 ? "tab-link active" : "tab-link")" @onclick="() => SelectTab(3)">
                        Resolved
                    </button>
                </nav>
            </div>

            <div class="report-list">
                @foreach (var item in reportedItems)
                {
                    <div class="@($"report-item {(selectedReportId == item.Id ? "active" : "")}")" @onclick="() => SelectReport(item.Id)">
                        <div class="report-icon">
                            @GetIconForReport(item.Type)
                        </div>
                        <div class="report-details">
                            <span class="report-title">@item.Title</span>
                            <span class="report-info">@item.ReporterInfo</span>
                            <span class="report-time">@item.Timestamp.ToString("MMM dd, yyyy")</span>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Column 2: Content Preview -->
        <div class="content-preview-column">
            @if (selectedReportId != Guid.Empty)
            {
                <h4 class="preview-title">Reviewing Profile: 'Inappropriate Profile: John D.'</h4>
                <div class="preview-content">
                    <h5 class="preview-header">Content Preview</h5>
                    <div class="profile-preview">
                        <img src="https://placehold.co/150x150/e0e7ff/4f46e5?text=JD" alt="User Avatar" class="profile-avatar" />
                        <div class="profile-details">
                            <h4>John D.</h4>
                            <p>"Expert in quantum carpentry. Building furniture that exists and doesn't exist at the same time. Contact me for a consultation."</p>
                        </div>
                    </div>
                </div>
                <div class="preview-actions">
                    <button class="btn btn-action-secondary">Reject Report</button>
                    <button class="btn btn-action-success">Approve</button>
                    <button class="btn btn-action-warning">Suspend User</button>
                    <button class="btn btn-action-danger">Ban User</button>
                </div>
            }
            else
            {
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M2.625 6.75A1.125 1.125 0 013.75 5.625H20.25a1.125 1.125 0 011.125 1.125V17.25a1.125 1.125 0 01-1.125 1.125H3.75a1.125 1.125 0 01-1.125-1.125V6.75zM3.75 6.75h16.5v10.5H3.75V6.75z" clip-rule="evenodd" /></svg>
                    <p>Select a report to review</p>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private int activeTab = 1;
    private Guid selectedReportId;
    private List<ReportedItem> reportedItems = new();

    protected override void OnInitialized()
    {
        reportedItems = new List<ReportedItem>
        {
            new ReportedItem { Id = Guid.NewGuid(), Title = "Inappropriate Profile: John D.", ReporterInfo = "Reported by Jane S. for Misleading information", Timestamp = new DateTime(2023, 10, 27), Type = ReportType.Profile, Status = "Pending" },
            new ReportedItem { Id = Guid.NewGuid(), Title = "Offensive Message in 'Project Discussion'", ReporterInfo = "Reported by Mike R. for Harassment", Timestamp = new DateTime(2023, 10, 26), Type = ReportType.Message, Status = "Pending" },
            new ReportedItem { Id = Guid.NewGuid(), Title = "Fake Review on 'Handcrafted Wallets'", ReporterInfo = "Reported by Sarah L. for Spam", Timestamp = new DateTime(2023, 10, 25), Type = ReportType.Review, Status = "Pending" },
            new ReportedItem { Id = Guid.NewGuid(), Title = "Misleading Project: 'Instant Home Repairs'", ReporterInfo = "Reported by Tom B. for Scam", Timestamp = new DateTime(2023, 10, 24), Type = ReportType.Project, Status = "Pending" }
        };
    }

    private void SelectTab(int tabIndex)
    {
        activeTab = tabIndex;
        // Logic to filter reports based on tab
    }

    private void SelectReport(Guid reportId)
    {
        selectedReportId = reportId;
    }

    private MarkupString GetIconForReport(ReportType type)
    {
        string svgPath = type switch
        {
            ReportType.Profile => "<path fill-rule='evenodd' d='M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zM12 6.75a.75.75 0 01.75.75v3a.75.75 0 01-1.5 0v-3a.75.75 0 01.75-.75zM12 12.75a.75.75 0 01.75.75v.008a.75.75 0 01-1.5 0v-.008a.75.75 0 01.75-.75z' clip-rule='evenodd' />",
            ReportType.Message => "<path fill-rule='evenodd' d='M5.339 2.25A1.125 1.125 0 016.45 2.25h11.1A1.125 1.125 0 0118.66 3.36l-4.012 3.595a.75.75 0 01-.976 0L9.34 3.36A1.125 1.125 0 0110.45 2.25h1.105a.75.75 0 000-1.5H6.45a2.625 2.625 0 00-2.625 2.625v10.5A2.625 2.625 0 006.45 16.5h11.1a2.625 2.625 0 002.625-2.625V8.25a.75.75 0 00-1.5 0v5.625a1.125 1.125 0 01-1.125 1.125H6.45A1.125 1.125 0 015.34 13.875V3.36z' clip-rule='evenodd' />",
            ReportType.Review => "<path fill-rule='evenodd' d='M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.799 2.313l-4.07 3.505 1.17 5.259c.28 1.258-1.004 2.23-2.06 1.625L12 17.318l-4.545 2.866c-1.056.605-2.34-.367-2.06-1.625l1.17-5.26-4.07-3.504c-.838-.768-.366-2.22.799-2.313l5.404-.434 2.082-5.006z' clip-rule='evenodd' />",
            _ => "<path fill-rule='evenodd' d='M19.904 9.125a.75.75 0 01.166 1.03l-3.375 4.962a.75.75 0 01-1.24-.002l-3.375-4.962a.75.75 0 01.166-1.03A.75.75 0 0112.75 9h.008a.75.75 0 01.75.75v.236l2.09 3.074a.75.75 0 001.21-.001l2.09-3.074v-.236a.75.75 0 01.75-.75h.008a.75.75 0 01.248.038zM11.992 3a.75.75 0 01.75.75v.236l2.09 3.074a.75.75 0 001.21-.001l2.09-3.074v-.236a.75.75 0 01.75-.75h.008c.414 0 .75.336.75.75v3.268a2.25 2.25 0 01-1.015 1.907l-3.375 4.962a2.25 2.25 0 01-3.72 0l-3.375-4.962A2.25 2.25 0 014.25 7.018V3.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.236l2.09 3.074a.75.75 0 001.21-.001l2.09-3.074v-.236A.75.75 0 0111.992 3z' clip-rule='evenodd' />"
        };
        return new MarkupString($"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'><g>{svgPath}</g></svg>");
    }
}