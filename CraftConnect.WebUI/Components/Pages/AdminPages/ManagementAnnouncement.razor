@page "/admin/announcements"
@layout AdminLayout
@using Core.SharedKernel.Enums
@using CraftConnect.WebUI.Components.AdminPagesComponents.ManagementAnnouncementPageComponents
@using CraftConnect.WebUI.Components.Layout.AdminPageLayouts

<div class="announcement-management-container">
    <!-- Page Header -->
    <header class="page-header">
        <h1>Manage Announcements</h1>
        <button class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>
            Create New Announcement
        </button>
    </header>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <div class="search-container">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" /></svg>
            <input type="text" class="search-input" placeholder="Search by title or keyword" />
        </div>
        <div class="dropdown-filters">
            <select class="filter-dropdown" @bind="statusFilter">
                <option value="">Status</option>
                <option value="Published">Published</option>
                <option value="Scheduled">Scheduled</option>
                <option value="Draft">Draft</option>
            </select>
            <select class="filter-dropdown" @bind="audienceFilter">
                <option value="">Target Audience</option>
                <option value="all-users">All Users</option>
                <option value="craftsmen/Women">Craftsmen/Women</option>
                <option value="customers">Customers</option>
            </select>
        </div>
    </div>

    <!-- Announcements Table -->
    <div class="table-container">
        <table class="announcement-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Publication Date</th>
                    <th>Status</th>
                    <th>Target Audience</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var announcement in filteredAnnouncements)
                {
                    <tr>
                        <td class="cell-title">@announcement.Title</td>
                        <td>@announcement.PublicationDate.ToString("yyyy-MM-dd")</td>
                        <td><AnnouncementStatusBadge Status="announcement.Status" /></td>
                        <td>@announcement.TargetAudience</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon" title="Edit">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                                </button>
                                <button class="btn-icon" title="Delete">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193v-.443A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd" /></svg>
                                </button>
                                <button class="btn-icon" title="Archive">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2 3.5A1.5 1.5 0 013.5 2h13A1.5 1.5 0 0118 3.5v10A1.5 1.5 0 0116.5 15h-13A1.5 1.5 0 012 13.5v-10zm0 10.25a.75.75 0 00.75.75h14.5a.75.75 0 00.75-.75v-10a.75.75 0 00-.75-.75H2.75a.75.75 0 00-.75.75v10z" clip-rule="evenodd" /><path fill-rule="evenodd" d="M3 17.5a.5.5 0 01.5-.5h13a.5.5 0 010 1h-13a.5.5 0 01-.5-.5z" clip-rule="evenodd" /></svg>
                                </button>
                                <button class="btn-icon" title="Duplicate">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M7 3.5A1.5 1.5 0 018.5 2h7A1.5 1.5 0 0117 3.5v7a1.5 1.5 0 01-1.5 1.5h-7A1.5 1.5 0 017 10.5v-7zM8.5 3a.5.5 0 00-.5.5v7a.5.5 0 00.5.5h7a.5.5 0 00.5-.5v-7a.5.5 0 00-.5-.5h-7z" /><path d="M3.5 7A1.5 1.5 0 015 5.5h7A1.5 1.5 0 0113.5 7v7a1.5 1.5 0 01-1.5 1.5h-7A1.5 1.5 0 013.5 14v-7zM5 7a.5.5 0 00-.5.5v7a.5.5 0 00.5.5h7a.5.5 0 00.5-.5v-7a.5.5 0 00-.5-.5h-7z" /></svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@code {
    private static string audienceFilter = "";
    private static string statusFilter = "";
    private List<AdminAnnouncement> allAnnouncements { get; set; } = [];
    private List<AdminAnnouncement> filteredAnnouncements { get
        {
            var announcements = allAnnouncements.AsEnumerable();
            if (!string.IsNullOrWhiteSpace(audienceFilter))
            {
                announcements = audienceFilter.ToLower() switch
                {
                    "all-users" => allAnnouncements.Where(an => an.TargetAudience.Contains("All Users", StringComparison.OrdinalIgnoreCase)).ToList(),
                    "craftsmen/women" => allAnnouncements.Where(an => an.TargetAudience.Contains("Craftsmen/Women", StringComparison.OrdinalIgnoreCase)).ToList(),
                    "customers" => allAnnouncements.Where(an => an.TargetAudience.Contains("Customers", StringComparison.OrdinalIgnoreCase)).ToList(),
                    _ => announcements
                };
            }

            if (!string.IsNullOrWhiteSpace(statusFilter))
            {
                announcements = statusFilter.ToLower() switch
                {
                    "published" => announcements.Where(an => an.Status.ToString().Contains("Published", StringComparison.OrdinalIgnoreCase)),
                    "scheduled" => announcements.Where(an => an.Status.ToString().Contains("Scheduled", StringComparison.OrdinalIgnoreCase)),
                    "draft" => announcements.Where(an => an.Status.ToString().Contains("Draft", StringComparison.OrdinalIgnoreCase)),
                    _ => announcements
                };
            }
            return announcements.ToList();
        }
    }
    

    protected override void OnInitialized()
    {
        // Mock data from the image
        allAnnouncements = new List<AdminAnnouncement>
        {
            new AdminAnnouncement { Id = Guid.NewGuid(), Title = "New Feature: Direct Messaging", PublicationDate = new DateTime(2023, 10, 26), Status = AnnouncementStatus.Published, TargetAudience = "All Users" },
            new AdminAnnouncement { Id = Guid.NewGuid(), Title = "Holiday Schedule Update", PublicationDate = new DateTime(2023, 11, 15), Status = AnnouncementStatus.Scheduled, TargetAudience = "Craftsmen/Women" },
            new AdminAnnouncement { Id = Guid.NewGuid(), Title = "Platform Maintenance", PublicationDate = new DateTime(2023, 10, 20), Status = AnnouncementStatus.Draft, TargetAudience = "All Users" },
            new AdminAnnouncement { Id = Guid.NewGuid(), Title = "Welcome to the new platform!", PublicationDate = new DateTime(2023, 9, 1), Status = AnnouncementStatus.Published, TargetAudience = "All Users" }
        };
    }
}