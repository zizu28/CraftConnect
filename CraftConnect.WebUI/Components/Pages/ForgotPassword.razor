@page "/forgot-password"
@layout ForgotPasswordLayout
@inject IHttpClientFactory httpClientFactory
@using CraftConnect.WebUI.Components.Layout
@using System.ComponentModel.DataAnnotations
@using System.Threading.Tasks

<div class="forgot-password-card">
    <EditForm Model="model" OnValidSubmit="HandleSendResetLink">
        <DataAnnotationsValidator />

        <div class="card-header">
            <h2>Forgot Your Password?</h2>
            <p>Enter the email address associated with your account, and we'll send you a link to reset your password.</p>
        </div>

        <div class="form-group">
            <label for="email">Email Address</label>
            <InputText id="email" class="form-control" @bind-Value="model.Email" placeholder="you@example.com" />
            <ValidationMessage For="@(() => model.Email)" />
        </div>

        <button type="submit" class="btn btn-primary btn-block" disabled="@formSubmitted">Send Reset Link</button>

    </EditForm>

    <div class="back-to-login">
        <a href="/login">Back to Log In</a>
    </div>
</div>

@code {
    private ForgotPasswordCommand model = new();
    private bool formSubmitted = false;

    private async Task HandleSendResetLink()
    {
        try
        {
            formSubmitted = true;
            // Handle the password reset logic here
            var httpClient = httpClientFactory.CreateClient("Backend");
            // await httpClient.PostAsJsonAsync("/api/users/change-password", );
            Console.WriteLine($"Password reset link sent to: {model.Email}");
            // You would typically show a confirmation message here
        }
        catch(Exception ex)
        {

        }
        finally
        {
            formSubmitted = false;
        }
    }
}